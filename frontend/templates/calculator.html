<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wendler 5/3/1 Workout Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/calculator.css') }}">
</head>
<body>
    <h1>Wendler 5/3/1 Calculator</h1>
    
    <section> 
        <p>
            <strong>Enter your most recent PR for each lift field.</strong>
        </p>
    </section>

    <!-- Form for collecting user input to calculate the workout plan -->
    <form method="post">
        <!-- Program Selector for 5/3/1 variation -->
        <label for="variation">Select 5/3/1 Variation:</label>
        <select id="variation" name="variation">
            <option value="standard">Standard 5/3/1</option>
            <option value="boring-but-big">Boring But Big</option>
            <option value="triumvirate">Triumvirate</option>
            <option value="joker-sets">Joker Sets</option>
            <option value="building-the-monolith">Building the Monolith</option>
            <option value="531-for-powerlifting">5/3/1 for Powerlifting</option>
        </select><br><br>

        <!-- Unit of Measure Selector -->
        <label for="unit_selector">Select Unit:</label>
        <select id="unit_selector" name="unit">
            <option value="lbs" {% if unit == 'lbs' %}selected{% endif %}>Pounds (lbs)</option>
            <option value="kg" {% if unit == 'kg' %}selected{% endif %}>Kilograms (kg)</option>
        </select><br><br>

        <!-- 1RM Input Fields -->
        <label for="bench_1rm">Bench 1RM:</label>
        <input type="number" id="bench_1rm" name="bench_1rm" required value="{{ request.form.get('bench_1rm', '') }}"><br><br>

        <label for="squat_1rm">Squat 1RM:</label>
        <input type="number" id="squat_1rm" name="squat_1rm" required value="{{ request.form.get('squat_1rm', '') }}"><br><br>
        
        <label for="ohp_1rm">Overhead Press 1RM:</label>
        <input type="number" id="ohp_1rm" name="ohp_1rm" required value="{{ request.form.get('ohp_1rm', '') }}"><br><br>

        <label for="deadlift_1rm">Deadlift 1RM:</label>
        <input type="number" id="deadlift_1rm" name="deadlift_1rm" required value="{{ request.form.get('deadlift_1rm', '') }}"><br><br>
        
        <!-- Submit button -->
        <input type="submit" value="Calculate Workout">
    </form>

    <!-- Error display -->
    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}
    
    <!-- Workout plan display -->
    {% if workout_plan %}
        <h2>Your Workout Plan (in {{ unit }})</h2>
        {% for week, lifts in workout_plan.items() %}
            <h3>{{ week }}</h3>
            {% for lift, sets in lifts.items() %}
                <strong>{{ lift }}:</strong>
                <span>
                    {% for reps, weight in sets %}
                        {{ reps }} x {{ weight }} {{ unit }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </span>
                <br><br>
            {% endfor %}
        {% endfor %}

    <!-- Generate and Download PDF button -->
        <div class="pdf-button-container">
            <form action="{{ url_for('generate_pdf') }}" method="POST">
                <input type="hidden" name="workout_plan" id="workout_plan_input">
                <input type="hidden" name="unit" value="{{ unit }}">
                <button type="submit" class="pdf-button">Download as PDF</button>
            </form>
        </div> 
        <script>
            document.getElementById('workout_plan_input').value = JSON.stringify({{ workout_plan | tojson | safe }});
        </script>  
    {% endif %}

    <!-- Home page return link -->
    <div style="margin-top: 20px;">
        <a href="{{ url_for('home') }}">Back to Home</a>
    </div>

    <!-- <script>
        // Function to convert between pounds and kilograms
        function convertUnits() {
            const unit = document.getElementById("unit_selector").value;
            const conversionFactor = unit === "kg" ? 0.453592 : 2.20462;

            document.querySelectorAll("#1rm_form input[type='number']").forEach(input => {
                input.value = Math.round(input.value * conversionFactor);
            });
        }
    </script> -->
</body>
</html>
